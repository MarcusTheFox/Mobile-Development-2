# Отчёт 4

## ScrollViewApp
Создано приложение ScrollViewApp, которое отображает 100 элементов, используя ScrollView.

### Экраны

<img width="406" height="866" alt="4-ScrollViewApp-1" src="https://github.com/user-attachments/assets/1e7f4e18-6a36-49b5-974d-6120d7741756" />

### Код
#### MainActivity.java
``` java
package ru.mirea.bublikov.scrollviewapp;

import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.widget.LinearLayout;
import android.widget.TextView;

import androidx.appcompat.app.AppCompatActivity;

public class MainActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        LinearLayout container = findViewById(R.id.container);
        LayoutInflater inflater = getLayoutInflater();

        for (int i = 1; i <= 100; i++) {
            View itemView = inflater.inflate(R.layout.item, container, false);
            TextView textView = itemView.findViewById(R.id.textView);
            textView.setText(String.format("Элемент %d", i));
            container.addView(itemView);
        }
    }
}
```

## ListViewApp
Создано приложение со списком из более чем 30 авторов и книг, используя ListView и ArrayAdapter.

### Экраны

<img width="413" height="872" alt="4-ListViewApp-1" src="https://github.com/user-attachments/assets/ad69b64c-92e8-4101-ad75-044b5a17a948" />

### Код
#### MainActivity.java
``` java
package ru.mirea.bublikov.listviewapp;

import android.os.Bundle;
import android.widget.ArrayAdapter;
import android.widget.ListView;

import androidx.appcompat.app.AppCompatActivity;

public class MainActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        ListView listView = findViewById(R.id.listView);
        String[] bookList = generateBookList();
        ArrayAdapter<String> adapter = new ArrayAdapter<String>(
                this,
                android.R.layout.simple_list_item_1,
                bookList
        );
        listView.setAdapter(adapter);
    }

    private String[] generateBookList() {
        return new String[]{
                "1. Джордж Оруэлл - 1984",
                "2. Рэй Брэдбери - 451 градус по Фаренгейту",
                "3. Михаил Булгаков - Мастер и Маргарита",
                "4. Федор Достоевский - Преступление и наказание",
                "5. Антуан де Сент-Экзюпери - Маленький принц",
                "6. Лев Толстой - Война и мир",
                "7. Эрих Мария Ремарк - Три товарища",
                "8. Оскар Уайльд - Портрет Дориана Грея",
                "9. Джером Сэлинджер - Над пропастью во ржи",
                "10. Харпер Ли - Убить пересмешника",
                "11. Фрэнсис Скотт Фицджеральд - Великий Гэтсби",
                "12. Габриэль Гарсиа Маркес - Сто лет одиночества",
                "13. Джейн Остин - Гордость и предубеждение",
                "14. Даниэль Киз - Цветы для Элджернона",
                "15. Кен Кизи - Пролетая над гнездом кукушки",
                "16. Артур Конан Дойл - Приключения Шерлока Холмса",
                "17. Виктор Гюго - Отверженные",
                "18. Эрнест Хемингуэй - Старик и море",
                "19. Уильям Голдинг - Повелитель мух",
                "20. Альбер Камю - Посторонний",
                "21. Курт Воннегут - Бойня номер пять",
                "22. Джон Стейнбек - Гроздья гнева",
                "23. Патрик Зюскинд - Парфюмер",
                "24. Колин Маккалоу - Поющие в терновнике",
                "25. Александр Дюма - Граф Монте-Кристо",
                "26. Маргарет Митчелл - Унесенные ветром",
                "27. Чак Паланик - Бойцовский клуб",
                "28. Станислав Лем - Солярис",
                "29. Аркадий и Борис Стругацкие - Пикник на обочине",
                "30. Дуглас Адамс - Автостопом по галактике",
                "31. Терри Пратчетт - Цвет волшебства"
        };
    }
}
```


## RecyclerViewApp
Создать приложение, отображающее список исторических событий с использованием RecyclerView.

### Экраны

<img width="557" height="1186" alt="4-RecyclerViewApp-1" src="https://github.com/user-attachments/assets/80a12040-7087-429e-bb08-2a8331088dd2" />

### Код
#### HistoricalEvent.java
``` java
package ru.mirea.bublikov.recyclerviewapp;

public class HistoricalEvent {
    private String name;
    private String description;
    private String iconName;

    public HistoricalEvent(String name, String description, String iconName) {
        this.name = name;
        this.description = description;
        this.iconName = iconName;
    }

    public String getName() {
        return name;
    }

    public String getDescription() {
        return description;
    }

    public String getIconName() {
        return iconName;
    }
}

```

#### EventViewHolder.java
``` java
package ru.mirea.bublikov.recyclerviewapp;

import android.view.View;
import android.widget.ImageView;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.recyclerview.widget.RecyclerView;

public class EventViewHolder extends RecyclerView.ViewHolder {
    final ImageView imageEventIcon;
    final TextView textEventName;
    final TextView textEventDescription;

    public EventViewHolder(@NonNull View itemView) {
        super(itemView);
        imageEventIcon = itemView.findViewById(R.id.imageEventIcon);
        textEventName = itemView.findViewById(R.id.textEventName);
        textEventDescription = itemView.findViewById(R.id.textEventDescription);
    }

    public ImageView getImageEventIcon() {
        return imageEventIcon;
    }

    public TextView getTextEventName() {
        return textEventName;
    }

    public TextView getTextEventDescription() {
        return textEventDescription;
    }
}
```

#### EventAdapter.java
``` java
package ru.mirea.bublikov.recyclerviewapp;

import android.content.Context;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;

import androidx.recyclerview.widget.RecyclerView;

import java.util.List;

public class EventAdapter extends RecyclerView.Adapter<EventViewHolder> {

    private final List<HistoricalEvent> events;
    private Context context;

    public EventAdapter(List<HistoricalEvent> events) {
        this.events = events;
    }

    @Override
    public EventViewHolder onCreateViewHolder(final ViewGroup parent, int viewType) {
        context = parent.getContext();
        View view = LayoutInflater.from(context).inflate(R.layout.event_item, parent, false);
        return new EventViewHolder(view);
    }

    @Override
    public void onBindViewHolder(EventViewHolder holder, int position) {
        HistoricalEvent event = events.get(position);
        int iconResourceId = context.getResources().getIdentifier(
                event.getIconName(),
                "drawable",
                context.getPackageName()
        );

        holder.getTextEventName().setText(event.getName());
        holder.getTextEventDescription().setText(event.getDescription());
        holder.getImageEventIcon().setImageResource(iconResourceId);
    }

    @Override
    public int getItemCount() {
        return events.size();
    }
}
```

#### MainActivity.java
``` java
package ru.mirea.bublikov.recyclerviewapp;

import android.os.Bundle;

import androidx.appcompat.app.AppCompatActivity;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import java.util.ArrayList;
import java.util.List;

public class MainActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        List<HistoricalEvent> events = getListData();
        EventAdapter adapter = new EventAdapter(events);
        RecyclerView recyclerView = findViewById(R.id.recyclerView);
        LinearLayoutManager layoutManager = new LinearLayoutManager(this, LinearLayoutManager.VERTICAL, false);

        recyclerView.setAdapter(adapter);
        recyclerView.setLayoutManager(layoutManager);
    }

    private List<HistoricalEvent> getListData() {
        List<HistoricalEvent> list = new ArrayList<>();
        list.add(new HistoricalEvent("753 г. до н.э.", "Основание Рима", "ic_rome"));
        list.add(new HistoricalEvent("1453 г.", "Падение Константинополя", "ic_fall"));
        list.add(new HistoricalEvent("1492 г.", "Христофор Колумб открывает Америку", "ic_columbus"));
        list.add(new HistoricalEvent("1961 г.", "Первый полет человека в космос", "ic_space"));
        list.add(new HistoricalEvent("1991 г.", "Создание первого веб-сайта (World Wide Web)", "ic_internet"));
        return list;
    }
}
```


## ShoppingList
В приложение ShoppingList на экран добавления/редактирования товара добавлен список курса валют с использованием RecyclerView.

### Экраны

<img width="568" height="1193" alt="4-ShoppingList-1" src="https://github.com/user-attachments/assets/4e885355-8e4b-4de4-b514-8bda1ae56a34" />

<img width="580" height="1194" alt="4-ShoppingList-2" src="https://github.com/user-attachments/assets/3544bd50-be3b-46b6-a89a-32514ffca7fb" />

### Код
#### Currency.java
``` java
package ru.mirea.bublikov.domain.models;

public class Currency {
    private CurrencyCode code;
    private double rate;

    public Currency(CurrencyCode code, double rate) {
        this.code = code;
        this.rate = rate;
    }

    public CurrencyCode getCode() { return code; }
    public String getName() { return code.getFullName(); }
    public String getFlagName() { return code.getFlagName(); }
    public double getRate() { return rate; }
}
```

#### CurrencyCode.java
``` java
package ru.mirea.bublikov.domain.models;

public enum CurrencyCode {
    RUB("Российский рубль", "flag_of_russia"),
    USD("Доллар США", "flag_of_the_united_states"),
    EUR("Евро", "flag_of_europe"),
    CNY("Китайский юань", "flag_of_china");

    private final String fullName;
    private final String flagName;

    CurrencyCode(String fullName, String flagName) {
        this.fullName = fullName;
        this.flagName = flagName;
    }

    public String getFullName() {
        return fullName;
    }

    public String getFlagName() {
        return flagName;
    }
}
```

#### CurrencyAdapter.java
``` java
package ru.mirea.bublikov.shoppinglist.presentation;

import android.content.Context;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;

import androidx.recyclerview.widget.RecyclerView;

import java.util.ArrayList;
import java.util.List;

import ru.mirea.bublikov.domain.models.Currency;
import ru.mirea.bublikov.shoppinglist.R;

public class CurrencyAdapter extends RecyclerView.Adapter<CurrencyViewHolder> {
    private List<Currency> currencies = new ArrayList<>();
    private Context context;

    public void setItems(List<Currency> items) {
        this.currencies = items;
    }

    @Override
    public CurrencyViewHolder onCreateViewHolder(final ViewGroup parent, int viewType) {
        context = parent.getContext();
        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.currency_item, parent, false);
        return new CurrencyViewHolder(view);
    }

    @Override
    public void onBindViewHolder(CurrencyViewHolder holder, int position) {
        Currency currency = currencies.get(position);
        int flagResId = context.getResources().getIdentifier(
                currency.getFlagName(),
                "drawable",
                context.getPackageName()
        );

        holder.getTextName().setText(String.format("%s (%s)", currency.getName(), currency.getCode()));
        holder.getTextRate().setText(String.format("%.2f RUB", currency.getRate()));
        holder.getImageFlag().setImageResource(flagResId);
    }

    @Override public int getItemCount() { return currencies.size(); }
}
```

#### CurrencyViewHolder.java
``` java
package ru.mirea.bublikov.shoppinglist.presentation;

import android.view.View;
import android.widget.ImageView;
import android.widget.TextView;

import androidx.annotation.NonNull;
import androidx.recyclerview.widget.RecyclerView;

import ru.mirea.bublikov.shoppinglist.R;

public class CurrencyViewHolder extends RecyclerView.ViewHolder {
    final ImageView imageFlag;
    final TextView textName;
    final TextView textRate;

    public CurrencyViewHolder(@NonNull View itemView) {
        super(itemView);
        imageFlag = itemView.findViewById(R.id.imageFlag);
        textName = itemView.findViewById(R.id.textCurrencyName);
        textRate = itemView.findViewById(R.id.textCurrencyRate);
    }

    public ImageView getImageFlag() {
        return imageFlag;
    }

    public TextView getTextName() {
        return textName;
    }

    public TextView getTextRate() {
        return textRate;
    }
}
```

#### CurrencyViewModel.java
``` java
package ru.mirea.bublikov.shoppinglist.presentation;

import androidx.lifecycle.LiveData;
import androidx.lifecycle.MutableLiveData;
import androidx.lifecycle.ViewModel;

import java.util.List;

import ru.mirea.bublikov.domain.models.Currency;
import ru.mirea.bublikov.domain.repository.CurrencyRepository;
import ru.mirea.bublikov.domain.usecases.GetCurrencyRatesUseCase;

public class CurrencyViewModel extends ViewModel {
    private final MutableLiveData<List<Currency>> currencyList = new MutableLiveData<>();

    public LiveData<List<Currency>> getCurrencyList() {
        return currencyList;
    }

    public CurrencyViewModel(CurrencyRepository repository) {
        List<Currency> rates = new GetCurrencyRatesUseCase(repository).execute();
        currencyList.setValue(rates);
    }
}

```

#### ShopItemActivity.java
``` java
package ru.mirea.bublikov.shoppinglist.presentation;

import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.EditText;
import android.widget.Spinner;

import androidx.appcompat.app.AppCompatActivity;
import androidx.lifecycle.ViewModelProvider;
import androidx.recyclerview.widget.LinearLayoutManager;
import androidx.recyclerview.widget.RecyclerView;

import java.util.ArrayList;
import java.util.List;

import ru.mirea.bublikov.domain.models.Currency;
import ru.mirea.bublikov.domain.models.CurrencyCode;
import ru.mirea.bublikov.domain.models.ShopItem;
import ru.mirea.bublikov.shoppinglist.R;

public class ShopItemActivity extends AppCompatActivity {

    private ShopItemViewModel shopItemViewModel;
    private CurrencyViewModel currencyViewModel;
    private CurrencyAdapter currencyAdapter;

    private EditText editTextName;
    private EditText editTextCount;
    private EditText editTextPrice;
    private Button buttonSave;
    private Spinner spinnerCurrency;
    private RecyclerView recyclerViewCurrencies;

    private int shopItemId = ShopItem.UNDEFINED_ID;
    private String screenMode = MODE_UNKNOWN;

    private static final String EXTRA_SCREEN_MODE = "extra_mode";
    private static final String EXTRA_SHOP_ITEM_ID = "extra_shop_item_id";
    private static final String MODE_ADD = "mode_add";
    private static final String MODE_EDIT = "mode_edit";
    private static final String MODE_UNKNOWN = "";

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_shop_item);

        parseIntent();
        initViews();

        ViewModelFactory factory = new ViewModelFactory(this);
        shopItemViewModel = new ViewModelProvider(this, factory).get(ShopItemViewModel.class);
        currencyViewModel = new ViewModelProvider(this, factory).get(CurrencyViewModel.class);

        setupRecyclerView();
        observeViewModel();
        setupClickListeners();

        if (screenMode.equals(MODE_EDIT)) {
            setTitle("Редактировать товар");
        } else {
            setTitle("Добавить товар");
        }
    }

    private void setupRecyclerView() {
        recyclerViewCurrencies = findViewById(R.id.recyclerViewCurrencies);
        currencyAdapter = new CurrencyAdapter();
        recyclerViewCurrencies.setAdapter(currencyAdapter);
        recyclerViewCurrencies.setLayoutManager(new LinearLayoutManager(this));
    }

    private void observeViewModel() {
        shopItemViewModel.shouldCloseScreen.observe(this, shouldClose -> {
            if (shouldClose) {
                finish();
            }
        });

        currencyViewModel.getCurrencyList().observe(this, currencies -> {
            currencyAdapter.setItems(currencies);
            setupSpinner(currencies);

            if (screenMode.equals(MODE_EDIT)) {
                shopItemViewModel.getShopItem(shopItemId);
            }
        });

        shopItemViewModel.shopItem.observe(this, item -> {
            if (item != null) {
                editTextName.setText(item.getName());
                editTextCount.setText(String.valueOf(item.getCount()));
                editTextPrice.setText(String.valueOf(item.getPrice()));
                setSpinnerSelection(item.getCurrency());
            }
        });
    }

    private void setupClickListeners() {
        buttonSave.setOnClickListener(v -> {
            int selectedPosition = spinnerCurrency.getSelectedItemPosition();
            CurrencyCode selectedCode = CurrencyCode.values()[selectedPosition];

            shopItemViewModel.saveShopItem(
                    editTextName.getText().toString(),
                    editTextCount.getText().toString(),
                    editTextPrice.getText().toString(),
                    selectedCode
            );
        });
    }

    private void setupSpinner(List<Currency> currencies) {
        List<String> currencyNames = new ArrayList<>();
        for (Currency c : currencies) {
            currencyNames.add(c.getName());
        }
        ArrayAdapter<String> spinnerAdapter = new ArrayAdapter<>(this, android.R.layout.simple_spinner_item, currencyNames);
        spinnerCurrency.setAdapter(spinnerAdapter);
    }

    private void setSpinnerSelection(CurrencyCode currencyCode) {
        if (currencyCode != null) {
            int position = currencyCode.ordinal();
            spinnerCurrency.setSelection(position);
        }
    }

    private void initViews() {
        editTextName = findViewById(R.id.editTextName);
        editTextCount = findViewById(R.id.editTextCount);
        editTextPrice = findViewById(R.id.editTextPrice);
        spinnerCurrency = findViewById(R.id.spinnerCurrency);
        buttonSave = findViewById(R.id.buttonSave);
    }

    private void parseIntent() {
        if (!getIntent().hasExtra(EXTRA_SCREEN_MODE)) {
            throw new RuntimeException("Screen mode is absent");
        }
        String mode = getIntent().getStringExtra(EXTRA_SCREEN_MODE);
        if (!mode.equals(MODE_ADD) && !mode.equals(MODE_EDIT)) {
            throw new RuntimeException("Unknown screen mode " + mode);
        }
        screenMode = mode;
        if (screenMode.equals(MODE_EDIT)) {
            if (!getIntent().hasExtra(EXTRA_SHOP_ITEM_ID)) {
                throw new RuntimeException("Shop item id is absent");
            }
            shopItemId = getIntent().getIntExtra(EXTRA_SHOP_ITEM_ID, ShopItem.UNDEFINED_ID);
        }
    }

    public static Intent newIntentAddItem(Context context) {
        Intent intent = new Intent(context, ShopItemActivity.class);
        intent.putExtra(EXTRA_SCREEN_MODE, MODE_ADD);
        return intent;
    }

    public static Intent newIntentEditItem(Context context, int shopItemId) {
        Intent intent = new Intent(context, ShopItemActivity.class);
        intent.putExtra(EXTRA_SCREEN_MODE, MODE_EDIT);
        intent.putExtra(EXTRA_SHOP_ITEM_ID, shopItemId);
        return intent;
    }
}
```

